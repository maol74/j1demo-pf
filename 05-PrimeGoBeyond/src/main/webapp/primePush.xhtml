<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html">
    <h:head>
        <title>Prime Push Location Checkin Example</title>
        <h:outputScript library="js" name="shCoreStaticInclude.js" />        
        <h:outputStylesheet library="css" name="SyntaxHighlighterModified.css" />        

        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

        <script type="text/javascript">
            //<![CDATA[
            function handleMessage(data) {
                var coords = new google.maps.LatLng(data.lat, data.lng),
                        map = PF('map'),
                        marker = new google.maps.Marker({
                        position: coords, title: data.title
                });

                map.addOverlay(marker);

                map.infowindow = new google.maps.InfoWindow({
                    content: '<h3>' + data.title + " just checked in!</h3>"
                });

                map.getMap().setCenter(coords);
                map.infowindow.open(map.getMap(), marker);
            }

            $(function() {
                navigator.geolocation.getCurrentPosition(
                        function(position) {
                            $(PrimeFaces.escapeClientId('form:lat')).val(position.coords.latitude);
                            $(PrimeFaces.escapeClientId('form:lng')).val(position.coords.longitude);
                        },
                        function(error) {
                            alert(error.message);
                        },
                        {
                            enableHighAccuracy: true
                        });
            });
            //]]> 
        </script>
    </h:head>
    <h:body>
        <h:form id="form">
            <p:fieldset legend="Type in Your Location">
                <h:panelGrid columns="2">
                    <p:outputLabel for="title" value="Title: " />
                    <p:inputText id="title" value="#{mapBean.title}" />
                    <p:spacer />
                    <p:commandButton value="Check-In" actionListener="#{mapBean.checkin}" />
                </h:panelGrid>
            </p:fieldset>

            <br />

            <p:gmap id="gmap" center="37.06250000000001,-95.67706800000002" zoom="15" type="HYBRID" style="width:600px;height:400px"
                    model="#{mapBean.emptyModel}" widgetVar="map" />

            <h:inputHidden id="lat" value="#{mapBean.lat}" />
            <h:inputHidden id="lng" value="#{mapBean.lng}" />

        </h:form>

        <p:socket onMessage="handleMessage" channel="/check-in" />
        <br/>
        <br/>
        <p:tabView>
            <p:tab title="xhtml">                 
            </p:tab>
            <p:tab title="Bean">                
                <div class="dp-highlighter"><div class="bar"><div class="tools"><a href="#" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy to clipboard</a><a href="#" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a></div></div><ol start="1" class="dp-cpp"><li class="alt"><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;MapBean&nbsp;implements&nbsp;Serializable&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;checkin()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PushContext&nbsp;pushContext&nbsp;=&nbsp;PushContextFactory.getDefault().getPushContext();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pushContext.push(<span class="string">"/check-in"</span><span>,&nbsp;</span><span class="keyword">new</span><span>&nbsp;CheckIn(title,&nbsp;lat,&nbsp;lng));&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;</span></li><li class="alt"><span>}&nbsp;&nbsp;</span></li></ol><textarea style="display:none;" class="originalCode">public class MapBean implements Serializable {
                        ...
                    public void checkin() {
                        PushContext pushContext = PushContextFactory.getDefault().getPushContext();        

                        pushContext.push("/check-in", new CheckIn(title, lat, lng));
                    }
                    ...
                }
                </textarea></div>                
            </p:tab>
            <p:tab title="CheckIn.java">                
                <div class="dp-highlighter"><div class="bar"><div class="tools"><a href="#" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="#" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy to clipboard</a><a href="#" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="#" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a></div></div><ol start="1" class="dp-cpp"><li class="alt"><span><span class="keyword">public</span><span>&nbsp;</span><span class="keyword">class</span><span>&nbsp;CheckIn&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;String&nbsp;title;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="datatypes">double</span><span>&nbsp;lat;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">private</span><span>&nbsp;</span><span class="datatypes">double</span><span>&nbsp;lng;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;CheckIn()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;CheckIn(String&nbsp;title,&nbsp;</span><span class="datatypes">double</span><span>&nbsp;lat,&nbsp;</span><span class="datatypes">double</span><span>&nbsp;lng)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.title&nbsp;=&nbsp;title;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.lat&nbsp;=&nbsp;lat;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.lng&nbsp;=&nbsp;lng;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="datatypes">double</span><span>&nbsp;getLat()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;lat;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setLat(</span><span class="datatypes">double</span><span>&nbsp;lat)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.lat&nbsp;=&nbsp;lat;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="datatypes">double</span><span>&nbsp;getLng()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;lng;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setLng(</span><span class="datatypes">double</span><span>&nbsp;lng)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.lng&nbsp;=&nbsp;lng;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;String&nbsp;getTitle()&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;title;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">public</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;setTitle(String&nbsp;title)&nbsp;{&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">this</span><span>.title&nbsp;=&nbsp;title;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</span></li><li class=""><span>}&nbsp;&nbsp;</span></li></ol><textarea style="display:none;" class="originalCode">public class CheckIn {

                    private String title;
                    private double lat;
                    private double lng;

                    public CheckIn() {

                    }

                    public CheckIn(String title, double lat, double lng) {
                        this.title = title;
                        this.lat = lat;
                        this.lng = lng;
                    }

                    public double getLat() {
                        return lat;
                    }

                    public void setLat(double lat) {
                        this.lat = lat;
                    }

                    public double getLng() {
                        return lng;
                    }

                    public void setLng(double lng) {
                        this.lng = lng;
                    }

                    public String getTitle() {
                        return title;
                    }

                    public void setTitle(String title) {
                        this.title = title;
                    }
                }
                </textarea></div>                
            </p:tab>
            <p:tab title="pom.xml">                
                <div class="dp-highlighter"><div class="bar"><div class="tools"><a href="\#" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="\#" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy to clipboard</a><a href="\#" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="\#" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a></div></div><ol start="1" class="dp-cpp"><li class="alt"><span><span>&lt;dependency&gt;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.atmosphere&lt;/groupId&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;atmosphere-runtime&lt;/artifactId&gt;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;2.0.0.RC3&lt;/version&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&lt;/dependency&gt;&nbsp;&nbsp;</span></li></ol><textarea style="display:none;" class="originalCode">        &lt;dependency&gt;
                    &lt;groupId&gt;org.atmosphere&lt;/groupId&gt;
                    &lt;artifactId&gt;atmosphere-runtime&lt;/artifactId&gt;
                    &lt;version&gt;2.0.0.RC3&lt;/version&gt;
                &lt;/dependency&gt;</textarea></div>
            </p:tab>
            <p:tab title="web.xml">                
                <div class="dp-highlighter"><div class="bar"><div class="tools"><a href="\#" onclick="dp.sh.Toolbar.Command('ViewSource',this);return false;">view plain</a><a href="\#" onclick="dp.sh.Toolbar.Command('CopyToClipboard',this);return false;">copy to clipboard</a><a href="\#" onclick="dp.sh.Toolbar.Command('PrintSource',this);return false;">print</a><a href="\#" onclick="dp.sh.Toolbar.Command('About',this);return false;">?</a></div></div><ol start="1" class="dp-cpp"><li class="alt"><span><span>&lt;context-param&gt;&nbsp;&nbsp;</span></span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;primefaces.PUSH_SERVER_URL&lt;/param-name&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;http:<span class="comment">//www.primefaces.org:8080&lt;/param-value&gt;</span><span>&nbsp;&nbsp;</span></span></li><li class=""><span>&lt;/context-param&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;</span></li><li class=""><span>&lt;servlet&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;Push&nbsp;Servlet&lt;/servlet-name&gt;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-<span class="keyword">class</span><span>&gt;org.primefaces.push.PushServlet&lt;/servlet-</span><span class="keyword">class</span><span>&gt;&nbsp;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;init-param&gt;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-name&gt;org.atmosphere.websocket.maxTextMessageSize&lt;/param-name&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;param-value&gt;0&lt;/param-value&gt;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/init-param&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&lt;/servlet&gt;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;</span></li><li class="alt"><span>&lt;servlet-mapping&gt;&nbsp;&nbsp;</span></li><li class=""><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;servlet-name&gt;Push&nbsp;Servlet&lt;/servlet-name&gt;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&lt;url-pattern&gt;/primepush/*&lt;/url-pattern&gt;&nbsp;&nbsp;</span></li><li class=""><span>&lt;/servlet-mapping&gt;&nbsp;&nbsp;</span></li></ol><textarea style="display:none;" class="originalCode">    &lt;context-param&gt;
                        &lt;param-name&gt;primefaces.PUSH_SERVER_URL&lt;/param-name&gt;
                        &lt;param-value&gt;http://www.primefaces.org:8080&lt;/param-value&gt;
                    &lt;/context-param&gt;

                    &lt;servlet&gt;
                        &lt;servlet-name&gt;Push Servlet&lt;/servlet-name&gt;
                        &lt;servlet-class&gt;org.primefaces.push.PushServlet&lt;/servlet-class&gt;
                        &lt;init-param&gt;
                            &lt;param-name&gt;org.atmosphere.websocket.maxTextMessageSize&lt;/param-name&gt;
                            &lt;param-value&gt;0&lt;/param-value&gt;
                        &lt;/init-param&gt;
                    &lt;/servlet&gt;

                    &lt;servlet-mapping&gt;
                        &lt;servlet-name&gt;Push Servlet&lt;/servlet-name&gt;
                        &lt;url-pattern&gt;/primepush/*&lt;/url-pattern&gt;
                    &lt;/servlet-mapping&gt;

                </textarea></div>                
            </p:tab>
        </p:tabView>            
        <br/>
        <br/>
        <h:form id="backForm">
            <p:commandButton action="index" value="Back" ajax="false" immediate="true" />
        </h:form>
    </h:body>
</html>

